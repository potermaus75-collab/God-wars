:root {
    --bg-color: #222;
    --panel-bg: #333;
    --slot-bg: #444;
    --primary: #4CAF50;
    --danger: #f44336;
    --gold: #ffd700;
}

* { box-sizing: border-box; user-select: none; }

body {
    margin: 0; background-color: #111; color: white;
    font-family: 'Segoe UI', sans-serif;
    display: flex; justify-content: center; height: 100vh; overflow: hidden;
}

/* 1. 시작 화면 (Z-Index 최상위) */
.full-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #1a1a1a; z-index: 9999;
    display: flex; justify-content: center; align-items: center;
}
.login-box { text-align: center; }
.login-box input { padding: 10px; font-size: 16px; margin-bottom: 10px; border-radius: 5px; border:none; text-align: center;}

/* 2. 게임 레이아웃 (Flexbox 수정) */
.game-container {
    width: 100%; max-width: 420px; height: 100%; 
    background-color: #2b2b2b;
    display: flex; flex-direction: column; 
    border-left: 1px solid #444; border-right: 1px solid #444;
    position: relative;
}
.hidden { display: none !important; }

/* 상단바 */
.top-bar { 
    flex-shrink: 0; 
    padding: 10px 15px; background: rgba(0,0,0,0.8); 
    display: flex; justify-content: space-between; align-items: center;
    border-bottom: 1px solid #444;
}
.stage-badge { font-weight: bold; color: var(--gold); font-size: 18px; }

/* 3. 전투 구역 & 워킹 애니메이션 */
.battle-stage {
    flex-shrink: 0; height: 280px; /* 고정 높이 */
    background: #202020; 
    position: relative; overflow: hidden;
    border-bottom: 1px solid #444;
}

.battle-field { 
    width: 100%; height: 100%; 
    position: relative;
}

/* 유닛 래퍼 (체력바 + 아트) */
.unit-wrapper {
    position: absolute; bottom: 40px; 
    display: flex; flex-direction: column; align-items: center;
    transition: transform 1.5s linear; /* 워킹 속도 */
}

/* 초기 위치 (화면 밖) */
.hero-start-pos { left: -100px; }
.enemy-start-pos { right: -100px; }

/* 전투 위치 (JavaScript로 클래스 추가시 이동) */
.unit-wrapper.walk-in-melee { transform: translateX(180px); } /* 유저 근접 */
.unit-wrapper.walk-in-range { transform: translateX(100px); } /* 유저 원거리 (덜 감) */
.unit-wrapper.walk-in-enemy { transform: translateX(-180px); } /* 적 */

/* 미니 체력바 */
.mini-hp-bar {
    width: 50px; height: 6px; background: #000; 
    border: 1px solid #555; margin-bottom: 5px; border-radius: 3px;
    position: absolute; top: -15px;
}
.mini-hp-bar .fill { height: 100%; width: 100%; transition: width 0.2s; }
#hero-hp-fill { background-color: #4CAF50; }
#enemy-hp-fill { background-color: #f44336; }

/* 보스 태그 */
#boss-tag { 
    position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
    background: red; color: white; padding: 2px 5px; font-size: 10px; border-radius: 3px; font-weight: bold;
}

/* CSS Art (Hero & Monster) - 이전과 유사하지만 크기/위치 미세조정 */
.css-hero { position: relative; width: 60px; height: 60px; }
.hero-head { width: 30px; height: 30px; background: #ffccaa; border-radius: 5px; position: absolute; top: 0; left: 15px; z-index: 2; box-shadow: 0 2px 2px rgba(0,0,0,0.5);}
.hero-head::after { content: ''; position: absolute; top: 5px; left: -2px; width: 34px; height: 8px; background: #555; }
.hero-body { width: 30px; height: 25px; background: #3498db; position: absolute; top: 25px; left: 15px; border-radius: 5px; z-index: 1; }
.weapon-hand { position: absolute; top: 20px; right: -10px; width: 40px; height: 40px; transform-origin: 0% 100%; transition: transform 0.1s; }
.weapon-hand.sword { border-right: 4px solid #ddd; border-bottom: 4px solid #ddd; width: 10px; height: 30px; transform: rotate(-45deg); }
.weapon-hand.bow { width: 20px; height: 30px; border-left: 3px solid #8b4513; border-radius: 50% 0 0 50%; right: 5px; top: 15px; }

.css-monster { position: relative; width: 70px; height: 70px; }
.css-monster .mon-body { width: 60px; height: 40px; background: #8bc34a; border-radius: 50% 50% 10% 10%; position: absolute; bottom: 0; left: 5px; transition: background 0.2s; }
.css-monster.boss .mon-body { width: 80px; height: 70px; background: #e91e63; left: -5px; border-radius: 40% 40% 20% 20%; }
.mon-eye { width: 8px; height: 8px; background: white; border-radius: 50%; position: absolute; bottom: 25px; z-index: 5; animation: blink 3s infinite; }
.mon-eye.left { left: 20px; } .mon-eye.right { left: 45px; }

/* 전투 애니메이션 */
.hero-atk-anim { animation: swing 0.2s; }
.hero-shoot-anim { animation: shoot 0.2s; }
.mon-hit-anim { animation: shake 0.3s; filter: brightness(2) sepia(1) hue-rotate(-50deg) saturate(5); }

@keyframes swing { 0% { transform: rotate(-45deg); } 50% { transform: rotate(45deg); } 100% { transform: rotate(-45deg); } }
@keyframes shoot { 0% { transform: translateX(0); } 50% { transform: translateX(-5px); } 100% { transform: translateX(0); } }
@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
@keyframes blink { 0%, 90% { transform: scaleY(1); } 95% { transform: scaleY(0.1); } 100% { scaleY(1); } }

/* 데미지 텍스트 */
.floating-txt { 
    position: absolute; font-weight: bold; font-size: 20px; color: white; 
    text-shadow: 1px 1px 0 #000; pointer-events: none;
    animation: floatUp 0.8s forwards;
}
@keyframes floatUp { from { transform: translateY(0); opacity: 1; } to { transform: translateY(-30px); opacity: 0; } }

/* 4. 장비 슬롯 (가변 높이, 스크롤 가능) */
.equipment-grid {
    flex: 1; /* 남는 공간 차지 */
    min-height: 0; /* Flexbox 스크롤 버그 방지 */
    overflow-y: auto; /* 내용 많으면 스크롤 */
    background: #2b2b2b; padding: 10px;
}
.slots-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding-bottom: 20px; }
.slot {
    aspect-ratio: 1; background: var(--slot-bg); border: 1px solid #555; border-radius: 6px;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    cursor: pointer; position: relative;
}

/* 등급 컬러 */
.grade-0 { border-color: #eee; }
.grade-1 { border-color: #87ceeb; color: #87ceeb; } 
.grade-2 { border-color: #90ee90; color: #90ee90; } 
.grade-3 { border-color: #ffd700; color: #ffd700; } 
.grade-4 { border-color: #ff4444; color: #ff4444; } 
.grade-5 { border-color: #d64bd6; color: #d64bd6; } 
.grade-6 { border-color: #00bfff; color: #00bfff; background: rgba(0, 100, 255, 0.1); } /* 바다색 */
.grade-7 { border-color: #aaaaff; color: #aaaaff; } 
.grade-8 { border-color: #d2b48c; color: #d2b48c; } 
.grade-9 { border: 2px solid gold; background: linear-gradient(135deg, #220000, #222200); color: gold; }

/* 5. 컨트롤 패널 (하단 고정, 축소 방지) */
.controls {
    flex-shrink: 0; /* 절대 줄어들지 않음 */
    background: #fff; color: #000; padding: 15px;
    border-top: 3px solid #ccc;
    display: flex; justify-content: space-between; align-items: center;
}
.anvil-info { display: flex; flex-direction: column; font-size: 14px; }
.anvil-lv-box { font-weight: bold; font-size: 16px; margin-bottom: 4px; }
.actions { display: flex; gap: 10px; }
.main-btn { 
    background: #2196F3; color: white; border: none; padding: 12px 20px; 
    border-radius: 8px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 5px;
}
.big-summon { padding: 12px 25px; font-size: 16px; }
.sub-btn { background: #78909c; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;}
.full-width { width: 100%; margin-top: 5px; }

/* 모달 */
.modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; display: flex; justify-content: center; align-items: center; }
.modal-content { background: #333; color: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 340px; }
.compare-box { display: flex; gap: 10px; margin-top: 10px; }
.card { flex: 1; background: #222; border: 1px solid #555; padding: 8px; border-radius: 5px; }
.card-title { text-align: center; color: #aaa; font-size: 12px; margin-bottom: 5px; }
.gear-view { font-size: 12px; min-height: 80px; margin-bottom: 5px; line-height: 1.4; }
.view-main { font-size: 16px; color: #ffeb3b; border-bottom: 1px solid #444; margin: 4px 0; }
